# .base Project Rules for Cursor AI

## Project Overview
.base is an AI generation platform for images using Replicate API with multiple models support, built with Next.js 14, TypeScript, Supabase, and Tailwind CSS.

## Code Style & Standards

### TypeScript
- Always use TypeScript strict mode
- Define proper types/interfaces, avoid `any`
- Use type inference when obvious
- Export types from separate files in `/types`

### Next.js
- Use App Router (not Pages Router)
- Server Components by default
- Use 'use client' only when necessary (interactivity, hooks, browser APIs)
- API routes in `/app/api`

### React
- Functional components with hooks
- Use proper dependency arrays
- Clean up effects (return cleanup functions)
- Avoid prop drilling (use context/zustand when needed)

### Naming Conventions
- Files: kebab-case (`action-selector.tsx`)
- Components: PascalCase (`ActionSelector`)
- Functions/variables: camelCase (`getUserData`)
- Constants: UPPER_SNAKE_CASE (`MAX_RETRIES`)
- Types/Interfaces: PascalCase (`UserData`, `GenerationStatus`)

## Project Structure

```
/app
  /api              # API routes
  /(pages)          # App pages
  layout.tsx        # Root layout
  page.tsx          # Home page
  globals.css       # Global styles

/components
  /ui               # Reusable UI components
  /*.tsx            # Feature components

/lib
  /supabase         # Supabase clients & types
  /replicate        # Replicate integration
  models-config.ts  # Models configuration
  utils.ts          # Utility functions

/types              # TypeScript types
```

## Models Configuration

### Adding New Models
1. Update `/lib/models-config.ts`
2. Add model to appropriate array (CREATE_MODELS, UPSCALE_MODELS, etc.)
3. Define all settings with proper types
4. Update MODELS.md documentation
5. Test with real API calls

### Model Structure
```typescript
{
  id: string,              // Unique ID
  name: string,            // Technical name
  displayName: string,     // User-facing name
  replicateModel: string,  // Replicate model path
  action: ActionType,      // Action category
  settings: ModelSetting[] // Configuration
}
```

## API Guidelines

### Error Handling
- Always return proper HTTP status codes
- Include error messages in JSON
- Log errors server-side
- Never expose sensitive data

### Authentication
- Check user auth in all protected routes
- Use Supabase RLS for data access
- Validate Telegram data properly

### Response Format
```typescript
// Success
{ data: any, status: 'success' }

// Error
{ error: string, status: 'error', code?: string }
```

## Database

### Supabase
- Use Row Level Security (RLS) for all tables
- Never expose service_role_key client-side
- Use proper indexes for queries
- Handle nullable fields properly

### Queries
- Use TypeScript types from `/lib/supabase/types.ts`
- Handle loading and error states
- Use React Query for caching

## Replicate Integration

### Token Pool
- Always use Token Pool Manager
- Don't hardcode tokens
- Handle token errors gracefully
- Report token failures

### Predictions
- Use webhook for completion (not polling)
- Store prediction IDs
- Handle all statuses (pending, processing, succeeded, failed)
- Implement proper timeouts

## UI/UX

### Design System
- Follow Figma design (pixel-perfect)
- Use Tailwind CSS utilities
- Use shadcn/ui components
- Dark theme by default

### Responsive Design
- Mobile-first approach
- Test on different screen sizes
- Use proper breakpoints (sm, md, lg, xl)

### Loading States
- Show loaders for async operations
- Disable buttons during loading
- Provide feedback to users
- Handle long operations (30s+)

### Error Messages
- User-friendly messages
- Actionable (what user can do)
- Log technical details server-side
- Don't expose internal errors

## Performance

### Optimization
- Use Next.js Image component
- Lazy load images
- Code splitting with dynamic imports
- Minimize client-side JavaScript

### Caching
- Use React Query for API calls
- Cache static assets
- Use Redis for session data (if needed)

### Bundle Size
- Check bundle analyzer
- Remove unused dependencies
- Use tree-shaking

## Security

### Never Expose
- Service role keys
- API tokens (except in env vars)
- User passwords
- Internal error details

### Always Validate
- User input
- File uploads
- Telegram data
- API parameters

### Rate Limiting
- Implement on critical endpoints
- Per-user limits
- Token-based throttling

## Git Workflow

### Commits
- Use conventional commits
- Clear, descriptive messages
- Small, focused commits

### Branches
- `main` - production
- `dev` - development
- `feature/*` - new features
- `fix/*` - bug fixes

### Before Commit
- Run `npm run lint`
- Test changed functionality
- Update documentation if needed
- Update CHANGELOG.md for significant changes ⚠️

## Documentation

### Code Comments
- Comment complex logic
- Explain "why", not "what"
- Use JSDoc for functions
- Keep comments up-to-date

### README & Docs
- Keep README.md updated
- Document API changes
- Update CHANGELOG.md ⚠️ IMPORTANT
- Maintain MODELS.md

## Testing

### Before Deployment
- Test all user flows
- Check error scenarios
- Verify API endpoints
- Test with real Replicate API
- Check mobile responsiveness

### Manual Testing Checklist
- [ ] Action selection
- [ ] Model selection
- [ ] Settings form
- [ ] Image upload (for edit/upscale/remove_bg)
- [ ] Generation creation
- [ ] Status updates
- [ ] Result display
- [ ] History page
- [ ] Download functionality

## Environment Variables

### Required
```env
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY
REPLICATE_API_TOKENS
NEXTAUTH_URL
NEXTAUTH_SECRET
TELEGRAM_BOT_TOKEN
```

### Never Commit
- `.env.local`
- `.env.production.local`
- Any files with secrets

## Common Tasks

### Adding New Action
1. Add to `ActionType` in models-config.ts
2. Create models array (e.g., `NEW_ACTION_MODELS`)
3. Update `getModelsByAction()` function
4. Update `getActionLabel()` function
5. Update UI components
6. Test end-to-end

### Adding New Model
1. Define in models-config.ts
2. Test Replicate API parameters
3. Add to appropriate models array
4. Document in MODELS.md
5. Update CHANGELOG.md
6. Test generation

### Debugging Issues
1. Check Vercel logs (production)
2. Check browser console
3. Check Supabase logs
4. Check Replicate status
5. Verify environment variables

## AI-Specific Instructions

When modifying this project:
1. **Always read** models-config.ts before suggesting model changes
2. **Check** existing components before creating new ones
3. **Follow** the established patterns
4. **Update** CHANGELOG.md for significant changes (CRITICAL!)
5. **Maintain** TypeScript types
6. **Test** API integrations
7. **Preserve** Figma design accuracy

## Priority Rules

1. **Security first** - Never compromise on security
2. **User experience** - Smooth, intuitive UI/UX
3. **Performance** - Fast, responsive app
4. **Maintainability** - Clean, documented code
5. **Scalability** - Design for growth

## Questions?

- Check README.md first
- Review existing code
- Check API documentation
- Ask user for clarification

---

Last updated: 2025-11-24
Version: 0.1.0



















